<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Campanha | Sombras do Abismo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body data-page="campanhas">
    <div class="background-overlay"></div>
    <div id="header-placeholder"></div>

    <main class="main-content" id="campaign-management-container" style="display: none;">
        <a href="campanhas.html" class="back-to-list-btn">&larr; Voltar para Campanhas</a>
        <div class="campaign-layout">
            <div class="campaign-main-content">
                <div class="content-box">
                    <!-- Adicionado ID para controle de visibilidade -->
                    <div id="campaign-header-and-tabs">
                        <div id="campaign-cover-image-display" class="campaign-cover-image"></div>
                        <div class="campaign-title-section">
                            <h2 id="campaign-title-display">Carregando...</h2>
                            <p id="campaign-synopsis-display" class="info-text"></p>
                            <button id="edit-campaign-info-btn" class="wizard-btn">Editar Informações</button>
                        </div>
                    </div>

                    <!-- Abas do Mestre -->
                    <div class="master-tabs">
                        <button class="tab-link active" data-tab="escudo-mestre">Escudo do Mestre</button>
                        <button class="tab-link" data-tab="mapa">Mapa</button>
                    </div>

                    <!-- Conteúdo das Abas -->
                    <div class="tab-content active" id="escudo-mestre">
                        <h4>Recursos do Mestre</h4>
                        <p>Aqui você verá as fichas dos agentes e a lista de jogadores. As notificações e rolagens de dados aparecerão na barra lateral.</p>

                        <!-- Seção para as fichas dos agentes -->
                        <div class="content-box" style="margin-top: 2rem; margin-bottom: 2rem;">
                            <h3 class="section-title">Agentes na Campanha</h3>
                            <div id="master-agents-grid" class="characters-grid">
                                <!-- Cards dos agentes da campanha serão injetados aqui -->
                            </div>
                            <p class="empty-message" id="no-agents-for-master" style="display: none;">Nenhum agente nesta campanha ainda.</p>
                        </div>

                        <!-- Nova seção para a lista de jogadores -->
                        <div class="content-box" style="margin-bottom: 2rem;">
                            <h3 class="section-title">Jogadores na Campanha</h3>
                            <div id="campaign-players-list" class="players-grid">
                                <!-- Cards de jogadores serão injetados aqui -->
                                <p class="empty-message" id="no-players-in-campaign" style="display: none;">Nenhum jogador nesta campanha ainda.</p>
                            </div>
                        </div>

                        <div class="master-tools-grid">
                            <div class="tool-placeholder">Fichas de Monstros</div>
                        </div>

                        <!-- Código de Convite movido para baixo e em um content-box separado -->
                        <div class="content-box" style="margin-top: 2rem;">
                            <h3 class="section-title">Código de Convite</h3>
                            <p>Compartilhe este código com seus jogadores para que eles possam se juntar à sua campanha.</p>
                            <div class="invite-code-display">
                                <span id="campaign-invite-code-display">SDA-XXXX</span>
                                <button id="generate-invite-code-btn" class="wizard-btn small-btn">Gerar Novo</button>
                            </div>
                        </div>
                    </div>
        
                    <div class="tab-content" id="mapa">
                        <!-- Layout Unificado do Mapa para o Mestre -->
                        <div class="master-map-layout">
                            <div id="map-board" class="map-board">
                                <div id="map-upload-placeholder" class="map-upload-placeholder">
                                    <p>Nenhum mapa carregado.</p>
                                    <p>Use os controles para carregar uma imagem de fundo.</p>
                                </div>
                            </div>
                            <div class="map-controls-panel">
                                <div class="map-main-controls">
                                    <h4>Controles Principais</h4>
                                    <button id="toggle-draw-mode-btn" class="wizard-btn small-btn">Ativar Modo Ocultador</button>
                                </div>
                                <div class="map-config-collapsible">
                                    <h4 class="collapsible-header">Configurações do Mapa &#9662;</h4>
                                    <div class="collapsible-content" style="display: none;">
                                        <div class="map-config-form">
                                            <input type="file" id="map-upload-input" accept="image/*" style="display: none;">
                                            <button class="wizard-btn small-btn" onclick="document.getElementById('map-upload-input').click()">Carregar Imagem de Fundo</button>
                                            <button id="reset-map-btn" class="wizard-btn danger-btn small-btn">Limpar Mapa</button>
                                        </div>
                                    </div>
                                </div>
                                <h4>Adicionar Token</h4>
                                <p class="info-text small-text">Arraste um agente para o mapa para criar seu token.</p>
                                <div id="map-character-tokens" class="map-character-tokens"></div>
                            </div>
                        </div>

                        <!-- Menu de Contexto Customizado para o Mapa (movido para dentro da aba) -->
                        <div id="map-context-menu" class="context-menu">
                            <ul>
                                <li id="remove-fog-area" style="display: none;">Remover Névoa</li>
                                <!-- Outras opções podem ser adicionadas aqui -->
                            </ul>
                        </div>
                    </div>
        
                    <div class="campaign-actions-footer">
                        <span id="save-status-indicator" class="save-status"></span>
                        <button id="delete-campaign-btn" class="wizard-btn danger-btn">Excluir Campanha</button>
                    </div>
        
                </div>
            </div>

            <aside class="notification-sidebar">
                <div class="sidebar-content">
                    <h3>Log de Atividades</h3>
                    <div id="real-time-log" class="roll-log">
                        <p class="log-placeholder">As rolagens de dados e outras ações dos jogadores aparecerão aqui.</p>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Novo Menu do Jogador -->
    <main class="main-content" id="player-view-container" style="display: none;">
        <a href="campanhas.html" class="back-to-list-btn">&larr; Voltar para Campanhas</a>
        
        <div class="content-box">
            <!-- Cabeçalho da Campanha -->
            <div class="campaign-display-header">
                <div id="player-view-campaign-cover" class="campaign-cover-image"></div>
                <div class="campaign-title-section">
                    <h2 id="player-view-campaign-title">Carregando...</h2>
                    <p id="player-view-campaign-synopsis" class="info-text"></p>
                </div>
            </div>

            <!-- Abas do Jogador -->
            <div class="master-tabs">
                <button class="tab-link active" data-tab="player-agents">Agentes</button>
                <button class="tab-link" data-tab="player-map">Mapa</button>
            </div>
    
            <!-- Agentes na Campanha -->
            <div class="tab-content active" id="player-agents">
                <h3 class="section-title">Agentes na Campanha</h3>
                <div id="campaign-agents-grid" class="characters-grid">
                    <!-- Cards de personagens serão injetados aqui -->
                </div>
                <div id="no-agents-in-campaign" class="empty-state" style="display: none; padding: 2rem 0;">
                    <p class="empty-message">Nenhum agente nesta campanha ainda.</p>
                    <p class="empty-submessage">Adicione seu primeiro agente para começar a jogar.</p>
                </div>
                <!-- Botão de Ação -->
                <div style="text-align:center; margin-top:3rem;">
                    <button id="add-agent-to-campaign-btn" class="wizard-btn">Adicionar Agente</button>
                </div>
            </div>

            <!-- Mapa do Jogador -->
            <div class="tab-content" id="player-map">
                <div class="map-container player-view">
                    <div id="player-map-board" class="map-board">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Editar Informações da Campanha -->
    <div id="edit-campaign-modal-overlay" class="modal-overlay">
        <div class="specialization-modal-content">
            <h1>Editar Campanha</h1>
            <form id="manage-campaign-form" class="personalization-form" novalidate>
                <div class="form-section" style="background: none; border: none; padding: 0;">
                    <div class="form-group">
                        <label for="campaign-title-modal">Título da Campanha</label>
                        <input type="text" id="campaign-title-modal" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="campaign-synopsis-modal">Sinopse</label>
                        <textarea id="campaign-synopsis-modal" name="synopsis"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="campaign-image-modal-input">Imagem de Capa</label>
                        <div class="image-preview-container">
                            <img id="campaign-image-modal-preview" src="https://via.placeholder.com/300x180" alt="Pré-visualização da capa">
                            <input type="file" id="campaign-image-modal-input" name="imageFile" accept="image/*" style="display: none;">
                            <button type="button" class="wizard-btn" onclick="document.getElementById('campaign-image-modal-input').click()">Alterar Imagem</button>
                        </div>
                    </div>
                </div>
            </form>
            <div class="modal-actions" style="margin-top: 2rem;">
                <button id="cancel-edit-btn" class="wizard-btn danger-btn">Cancelar</button>
                <button id="save-edit-btn" class="wizard-btn">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Agente à Campanha -->
    <div id="add-agent-modal-overlay" class="modal-overlay">
        <div class="specialization-modal-content">
            <h1>Adicionar Agente à Campanha</h1>
            <p class="info-text">Escolha um dos seus agentes existentes ou crie um novo para se juntar a esta campanha.</p>
            
            <div id="select-agent-list" class="characters-grid modal-character-list">
                <!-- Lista de agentes do usuário para seleção -->
            </div>
    
            <div class="modal-actions" style="margin-top: 2rem; border-top: 1px solid var(--color-surface-2); padding-top: 2rem;">
                <button id="cancel-add-agent-btn" class="wizard-btn danger-btn">Cancelar</button>
                <a href="criar-agente.html" id="create-and-add-agent-btn" class="wizard-btn">Criar Novo Agente</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="script.js"></script>
</body>
</html>