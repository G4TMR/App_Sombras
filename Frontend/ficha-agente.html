<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Agente | Sombras do Abismo</title>
    <meta name="description" content="Sistema de Ficha de Agente - Sombras do Abismo RPG">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/favicon.png" sizes="any" type="image/png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body data-page="agentes">
    <div class="background-overlay"></div>
    <div id="header-placeholder"></div>

    <!-- Bot√£o para voltar para a campanha, inicialmente oculto -->
    <a href="#" id="back-to-campaign-btn" class="back-to-list-btn" style="display: none; margin: 1rem 0 0 2rem;">&larr; Voltar para a Campanha</a>

    <main id="sheet-container" class="sheet-container" style="display: none;">
        <!-- Cabe√ßalho da Ficha -->
        <header class="sheet-header">
            <div class="sheet-header-main-info">
                <span id="sheet-save-indicator" class="sheet-save-indicator">Salvando...</span>
                <div class="sheet-header-image-container">
                    <img id="sheet-char-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjM2QzZDRmIj48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNhYWFiYmYiIGZvbnQtc2l6ZT0iMjBweCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPjE1MHgxNTA8L3RleHQ+PC9zdmc+" alt="Retrato do Agente" class="sheet-header-image">
                    <input type="file" id="sheet-image-input" accept="image/*" style="display: none;">
                    <div class="sheet-image-overlay"><span>Alterar</span></div>
                </div>
                <div class="sheet-header-text">
                    <h2 id="sheet-char-name">Nome do Agente</h2>
                    <p id="sheet-char-element" class="sheet-element-tag"></p>
                    <p id="sheet-char-class-player">Classe | Jogador</p>
                </div>
            </div>
        </header>

        <!-- Corpo da Ficha -->
        <div class="sheet-main-desktop">
            <!-- ================================================================== -->
            <!-- COLUNA ESQUERDA (DESKTOP) / SE√á√ÉO ATRIBUTOS (MOBILE) -->
            <!-- ================================================================== -->
            <div id="mobile-section-attributes" class="sheet-col-left sheet-mobile-section">
                <section class="sheet-section">
                    <h3>Atributos e Status</h3>
                    <!--
                        O conte√∫do original da coluna esquerda (atributos, barras de status, defesa, etc.)
                        permanece aqui dentro. Nenhuma mudan√ßa interna √© necess√°ria.
                    -->
                    <div class="primary-attributes-display visual-mode">
                        <div class="attributes-bg-container">
                            <!-- Imagem de fundo removida daqui e aplicada via CSS para evitar bugs visuais -->
                            
                            <!-- For√ßa (Topo) -->
                            <div class="attr-point" style="top: 8%; left: 50%;" data-attr="forca">
                                <span id="sheet-forca" class="attr-value-text">--</span>
                                <button class="attr-btn-add" data-action="increase" title="Aumentar For√ßa">+</button>
                            </div>

                            <!-- Agilidade (Direita Superior) -->
                            <div class="attr-point" style="top: 32%; left: 88%;" data-attr="agilidade">
                                <span id="sheet-agilidade" class="attr-value-text">--</span>
                                <button class="attr-btn-add" data-action="increase" title="Aumentar Agilidade">+</button>
                            </div>

                            <!-- Presen√ßa (Direita Inferior) -->
                            <div class="attr-point" style="top: 78%; left: 78%;" data-attr="presenca">
                                <span id="sheet-presenca" class="attr-value-text">--</span>
                                <button class="attr-btn-add" data-action="increase" title="Aumentar Presen√ßa">+</button>
                            </div>

                            <!-- Vitalidade (Esquerda Inferior) -->
                            <div class="attr-point" style="top: 78%; left: 22%;" data-attr="vitalidade">
                                <span id="sheet-vitalidade" class="attr-value-text">--</span>
                                <button class="attr-btn-add" data-action="increase" title="Aumentar Vitalidade">+</button>
                            </div>

                            <!-- Intelig√™ncia (Esquerda Superior) -->
                            <div class="attr-point" style="top: 32%; left: 12%;" data-attr="inteligencia">
                                <span id="sheet-inteligencia" class="attr-value-text">--</span>
                                <button class="attr-btn-add" data-action="increase" title="Aumentar Intelig√™ncia">+</button>
                            </div>

                            <!-- Especializa√ß√£o (Centro) -->
                            <div id="class-specialization-block" class="attr-point center" style="top: 50%; left: 50%;" data-attr="classe">
                                <span id="sheet-class-specialization" class="spec-label">Classe</span>
                                <button class="attr-btn-add" data-action="specialize" title="Especializar">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="status-bars-container">
                        <div class="status-bar-wrapper">
                            <div class="status-bar-info">
                                <span class="status-bar-label">HP</span>
                                <div class="status-bar-values-editable">
                                    <button class="status-btn minus" data-stat="hp_current" data-amount="-1" title="Diminuir HP">-</button>
                                    <span id="hp-current" class="status-value-display">--</span>
                                    <button class="status-btn plus" data-stat="hp_current" data-amount="1" title="Aumentar HP">+</button>
                                    <span class="separator">/</span>
                                    <input type="number" id="hp-max" class="status-input" title="HP M√°ximo">
                                </div>
                            </div>
                            <div class="status-bar-background"><div id="hp-bar-fill" class="status-bar-fill hp"></div></div>
                        </div>
                        <div class="status-bar-wrapper">
                            <div class="status-bar-info">
                                <span class="status-bar-label">SAN</span>
                                <div class="status-bar-values-editable">
                                    <button class="status-btn minus" data-stat="sanity_current" data-amount="-1" title="Diminuir Sanidade">-</button>
                                    <span id="sanity-current" class="status-value-display">--</span>
                                    <button class="status-btn plus" data-stat="sanity_current" data-amount="1" title="Aumentar Sanidade">+</button>
                                    <span class="separator">/</span>
                                    <input type="number" id="sanity-max" class="status-input" title="Sanidade M√°xima">
                                </div>
                            </div>
                            <div class="status-bar-background"><div id="sanity-bar-fill" class="status-bar-fill sanity"></div></div>
                        </div>
                        <div class="status-bar-wrapper">
                            <div class="status-bar-info">
                                <span class="status-bar-label">PA</span>
                                <div class="status-bar-values-editable">
                                    <button class="status-btn minus" data-stat="pa_current" data-amount="-1" title="Diminuir PA">-</button>
                                    <span id="pa-current" class="status-value-display">--</span>
                                    <button class="status-btn plus" data-stat="pa_current" data-amount="1" title="Aumentar PA">+</button>
                                    <span class="separator">/</span>
                                    <input type="number" id="pa-max" class="status-input" title="PA M√°ximo">
                                </div>
                            </div>
                            <div class="status-bar-background"><div id="pa-bar-fill" class="status-bar-fill pa"></div></div>
                        </div>
                    </div>
                    <!-- NOVO SISTEMA DE DEFESA -->
                    <div class="defense-container">
                        <h4>Sistema de Defesa</h4>
                        <div class="defense-system">
                            <!-- Sele√ß√£o de Tipo de Defesa -->
                            <div class="defense-type-selector">
                                <button id="defense-block-btn" class="defense-type-btn active" data-type="block" title="Bloquear - usa Vitalidade">
                                    üõ°Ô∏è Bloquear
                                </button>
                                <button id="defense-dodge-btn" class="defense-type-btn" data-type="dodge" title="Esquivar - usa Agilidade">
                                    ‚ö° Esquivar
                                </button>
                            </div>

                            <!-- C√°lculo de Defesa -->
                            <div class="defense-calculation">
                                <div class="defense-calc-row">
                                    <span class="defense-calc-label">Base:</span>
                                    <span id="defense-base" class="defense-calc-value">--</span>
                                </div>
                                <div class="defense-calc-row">
                                    <span class="defense-calc-label">Habilidades:</span>
                                    <span id="defense-passive" class="defense-calc-value">+0</span>
                                </div>
                                <div class="defense-calc-row">
                                    <span class="defense-calc-label">B√¥nus Manual:</span>
                                    <div class="defense-bonus-input-group">
                                        <button class="defense-bonus-btn minus" data-action="decrease" title="Diminuir">-</button>
                                        <input type="number" id="defense-bonus-input" class="defense-bonus-input" value="0" min="0" title="B√¥nus manual de defesa">
                                        <button class="defense-bonus-btn plus" data-action="increase" title="Aumentar">+</button>
                                    </div>
                                </div>
                                <div class="defense-calc-row defense-total">
                                    <span class="defense-calc-label">Total:</span>
                                    <span id="sheet-defense" class="defense-value">--</span>
                                </div>
                            </div>

                            <!-- Bot√£o para Rolar Defesa -->
                            <button id="roll-defense-btn" class="roll-defense-btn">Rolar Defesa</button>
                        </div>
                    </div>
                    <div class="proficiencies-box">
                        <h4>Profici√™ncias</h4>
                        <p id="sheet-proficiencies">Proficiente com: Armas simples.</p>
                    </div>
                    <div class="progression-container">
                        <div class="progression-grid">
                            <div class="progression-block">
                                <span class="progression-label">N√≠vel</span>
                                <span id="sheet-level" class="progression-value">--</span>
                            </div>
                            <div class="progression-block">
                                <span class="progression-label">NF (N√≠vel de Fragmenta√ß√£o)</span>
                                <div id="nf-control" class="progression-control">
                                    <button class="progression-btn minus" data-stat="nf" data-amount="-1" title="Diminuir NF">-</button>
                                    <span id="sheet-nf" class="progression-value">--</span>
                                    <button class="progression-btn plus" data-stat="nf" data-amount="1" title="Aumentar NF">+</button>
                                </div>
                            </div>
                            <div class="progression-block">
                                <span class="progression-label">Pontos de Atributo</span>
                                <span id="sheet-attribute-points" class="progression-value">--</span>
                            </div>
                            <div class="progression-block">
                                <span class="progression-label">Pontos de Habilidade</span>
                                <span id="sheet-skill-points" class="progression-value">--</span>
                            </div>
                        </div>
                        <div class="progression-actions">
                            <button id="add-xp-btn">Adicionar XP</button>
                            <button id="level-up-btn" style="display: none;">Subir de N√≠vel</button>
                        </div>
                    </div>
                    <div class="resistances-container">
                        <h3>Resist√™ncias</h3>
                        <div class="resistances-grid">
                            <div class="resistance-block">
                                <span class="resistance-label">Prote√ß√£o</span>
                                <span id="sheet-protection" class="resistance-value">0</span>
                            </div>
                            <div class="resistance-block">
                                <span class="resistance-label">Bal√≠stica</span>
                                <span id="sheet-res-balistica" class="resistance-value">0</span>
                            </div>
                            <div class="resistance-block">
                                <span class="resistance-label">Corte</span>
                                <span id="sheet-res-corte" class="resistance-value">0</span>
                            </div>
                            <div class="resistance-block">
                                <span class="resistance-label">Paranormal</span>
                                <span id="sheet-res-paranormal" class="resistance-value">0</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ================================================================== -->
            <!-- COLUNA CENTRAL (DESKTOP) / SE√á√ÉO PER√çCIAS (MOBILE) -->
            <!-- ================================================================== -->
            <div id="mobile-section-proficiencies" class="sheet-col-center sheet-mobile-section">
                <section class="sheet-section">
                    <h3>Per√≠cias</h3>
                    <!--
                        O conte√∫do original da coluna central (lista de per√≠cias) permanece aqui.
                    -->
                    <div id="proficiencies-container" class="proficiencies-container">
                        <div class="proficiencies-header">
                            <span>Treinada</span>
                            <span>Per√≠cia</span>
                            <span>Rolar</span>
                            <span>Total</span>
                        </div>
                        <ul id="proficiencies-list" class="proficiencies-list">
                            <!-- As per√≠cias ser√£o populadas aqui -->
                        </ul>
                    </div>
                </section>
            </div>

            <!-- ================================================================== -->
            <!-- COLUNA DIREITA (DESKTOP) / M√öLTIPLAS SE√á√ïES (MOBILE) -->
            <!-- ================================================================== -->
            <div class="sheet-col-right">
                <!-- NOVO: Bot√µes de A√ß√£o Principais -->
                <div class="main-actions-container">
                    <button id="open-skills-modal-btn" class="wizard-btn">Habilidades</button>
                </div>

                <!-- Container para as se√ß√µes que ser√£o separadas no mobile -->
                <div class="actions-accordion">
                    <!-- Habilidades Desbloqueadas -->
                    <div id="mobile-section-skills" class="accordion-panel sheet-mobile-section">
                        <button class="accordion-header">Habilidades Desbloqueadas</button>
                        <div class="accordion-content">
                            <div id="unlocked-skills-container" class="skill-tree-container"></div>
                        </div>
                    </div>
                    <!-- Invent√°rio -->
                    <div id="mobile-section-inventory" class="accordion-panel sheet-mobile-section">
                        <button class="accordion-header">Invent√°rio</button>
                        <div class="accordion-content">
                            <ul id="sheet-inventory-list" class="inventory-list"></ul>
                            <form id="add-item-form" class="add-item-form">
                                <input type="text" id="add-item-input" class="add-item-input" placeholder="Novo item...">
                                <button type="submit" class="add-item-btn">+</button>
                            </form>
                        </div>
                    </div>
                    <!-- Detalhes e Origem (Lore) - Controlada pelo JavaScript -->
                    <div id="mobile-section-lore" class="lore-section sheet-mobile-section">
                        <h3>Detalhes e Origem</h3>
                        <div class="lore-content">
                            <div class="details-group">
                                <h4>Apar√™ncia</h4>
                                <textarea id="sheet-appearance" class="details-textarea" rows="3"></textarea>
                            </div>
                            <div class="details-group">
                                <h4>Hist√≥ria</h4>
                                <textarea id="sheet-history" class="details-textarea" rows="5"></textarea>
                            </div>
                            <div class="details-group">
                                <h4>Motiva√ß√£o</h4>
                                <textarea id="sheet-motivation" class="details-textarea" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- Rolagem de Dados -->
                    <div id="mobile-section-dice" class="accordion-panel sheet-mobile-section">
                        <button class="accordion-header">Rolagem de Dados</button>
                        <div class="accordion-content">
                            <form id="dice-roller-form" class="dice-roller-form">
                                <input type="number" id="dice-count" value="1">
                                <span>d</span>
                                <select id="dice-type">
                                    <option>4</option>
                                    <option>6</option>
                                    <option>8</option>
                                    <option>10</option>
                                    <option>12</option>
                                    <option selected>20</option>
                                    <option>100</option>
                                </select>
                                <span>+</span>
                                <input type="number" id="dice-bonus" value="0">
                                <button type="submit" class="roll-btn">Rolar</button>
                            </form>
                            <div id="roll-log" class="roll-log">
                                <p class="log-placeholder">O resultado das rolagens aparecer√° aqui.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="character-not-found" style="display: none; text-align: center; padding: 4rem;">
        <h2>Agente n√£o encontrado</h2>
        <p>O agente que voc√™ est√° procurando n√£o foi encontrado. <a href="agentes.html">Voltar para a lista de agentes.</a></p>
    </div>

    <!-- ================================================================== -->
    <!-- NOVO: MENU FLUTUANTE PARA NAVEGA√á√ÉO MOBILE -->
    <!-- ================================================================== -->
    <div class="mobile-fab-container">
        <div id="mobile-nav-menu" class="mobile-nav-menu">
            <a href="#mobile-section-lore">Lore</a>
            <a href="#mobile-section-attributes">Atributos</a>
            <a href="#mobile-section-proficiencies">Per√≠cias</a>
            <a href="#mobile-section-skills">Habilidades</a>
            <a href="#mobile-section-inventory">Invent√°rio</a>
            <a href="#mobile-section-dice">Dados</a>
        </div>
        <button id="mobile-fab" class="mobile-fab" aria-label="Abrir menu de se√ß√µes">
            <svg class="fab-icon icon-grid" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 11h8V3H3v8zm0 10h8v-8H3v8zm10 0h8v-8h-8v8zm0-18v8h8V3h-8z"/></svg>
            <svg class="fab-icon icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
    </div>

    <!-- Modal para Escolha de Especializa√ß√£o -->
    <div id="specialization-choice-overlay" class="modal-overlay">
        <div class="specialization-modal-content">
            <h1>Escolha sua Especializa√ß√£o</h1>
            <p class="info-text">Voc√™ atingiu o n√≠vel 5! Sua jornada o levou a um ponto de defini√ß√£o. Escolha o caminho que seu agente ir√° trilhar. Esta decis√£o √© permanente.</p>
            <div id="specialization-options-container" class="specialization-options-container">
                <!-- Op√ß√µes ser√£o inseridas aqui pelo script -->
            </div>
        </div>
    </div>

    <!-- NOVO: Modal de Habilidades com Abas por Elemento -->
    <div id="skill-tree-modal-overlay" class="modal-overlay">
        <div class="skill-tree-modal-content">
            <button id="close-skills-modal-btn" class="close-viewer-btn">&times;</button>
            <button id="skills-settings-btn" class="skills-settings-btn" title="Configura√ß√µes de Habilidades">‚öôÔ∏è</button>
            
            <!-- Abas por Elemento -->
            <div class="skill-modal-tabs">
                <button class="skill-tab-btn active" data-element="temporal">
                    <span class="tab-icon">‚è≥</span> Temporal
                </button>
                <button class="skill-tab-btn" data-element="cerebral">
                    <span class="tab-icon">üß†</span> Cerebral
                </button>
                <button class="skill-tab-btn" data-element="visceral">
                    <span class="tab-icon">‚ù§Ô∏è</span> Visceral
                </button>
                <button class="skill-tab-btn" data-element="vital">
                    <span class="tab-icon">üå±</span> Vital
                </button>
            </div>

            <!-- Filtros por Tipo -->
            <div class="skill-filters">
                <button class="filter-btn active" data-filter="all">Todas</button>
                <button class="filter-btn" data-filter="ofensiva">‚öîÔ∏è Ofensiva</button>
                <button class="filter-btn" data-filter="defensiva">üõ°Ô∏è Defensiva</button>
                <button class="filter-btn" data-filter="passiva">‚ú® Passiva</button>
                <button class="filter-btn" data-filter="utility">üîß Utility</button>
            </div>

            <!-- Badge de restri√ß√£o de elemento (quando multi-elemento desativado) -->
            <div id="element-restriction-badge" class="element-restriction-badge" style="display: none;">
                üîí Voc√™ pode usar apenas habilidades do elemento <strong id="current-element-name">Temporal</strong>
            </div>

            <!-- Grid de Habilidades -->
            <div class="skill-grid-container">
                <div id="skill-cards-grid" class="skill-cards-grid">
                    <!-- Cards de habilidades ser√£o renderizados aqui -->
                </div>
            </div>

            <!-- Painel de Detalhes (expande ao clicar em card) -->
            <div id="skill-details-panel" class="skill-details-panel"></div>
        </div>

        <!-- Modal de Configura√ß√µes (Settigns) -->
        <div id="skills-settings-modal" class="skills-settings-modal" style="display: none;">
            <div class="skills-settings-content">
                <button id="close-settings-modal-btn" class="close-viewer-btn" style="position: absolute; top: 1rem; right: 1rem;">&times;</button>
                <h2>‚öôÔ∏è Configura√ß√µes de Habilidades</h2>
                
                <div class="settings-section">
                    <h3>Regras de Elemento</h3>
                    <p class="settings-description">Por padr√£o, personagens podem usar habilidades de apenas um elemento. Ative a op√ß√£o abaixo para permitir m√∫ltiplos elementos.</p>
                    
                    <div class="settings-toggle-group">
                        <label class="settings-toggle-label">
                            <input type="checkbox" id="multi-element-toggle" class="settings-toggle-input">
                            <span class="settings-toggle-slider"></span>
                            <span class="settings-toggle-text">Habilitar Multi-Elemento</span>
                        </label>
                        <p class="settings-toggle-info">Quando ativado, voc√™ pode desbloquear e usar habilidades de qualquer elemento</p>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Visibilidade da Ficha</h3>
                    <p class="settings-description">Controle quem pode visualizar sua ficha quando conectado em uma campanha. O mestre sempre pode ver e alterar.</p>
                    
                    <div class="settings-toggle-group">
                        <label class="settings-toggle-label">
                            <input type="checkbox" id="sheet-visibility-toggle" class="settings-toggle-input" checked>
                            <span class="settings-toggle-slider"></span>
                            <span class="settings-toggle-text">Vis√≠vel para Outros Jogadores</span>
                        </label>
                        <p class="settings-toggle-info">Quando desativado, apenas o mestre pode ver sua ficha</p>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Status Atual</h3>
                    <p id="current-rule-status">
                        <strong>Regra Ativa:</strong> <span id="rule-status-text">Elemento √önico (Padr√£o)</span>
                    </p>
                    <p id="current-visibility-status">
                        <strong>Visibilidade:</strong> <span id="visibility-status-text">Vis√≠vel para Outros Jogadores</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. Importa a biblioteca Axios PRIMEIRO -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Importa os dados das √°rvores -->
    <script src="skillTrees.js"></script>
    <!-- Importa o script principal que usa Axios e os dados das √°rvores -->
    <script src="script.js"></script>
</body>
</html>