<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Campanha | Sombras do Abismo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.png" sizes="any" type="image/png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body data-page="campanhas">
    <div class="background-overlay"></div>
    <div id="header-placeholder"></div>

    <main class="main-content">
        <div class="content-box">
            <h2>Criar Nova Campanha</h2>
            <p class="info-text">Defina os pilares da sua nova hist√≥ria de terror. Preencha os detalhes abaixo para come√ßar.</p>

            <form id="create-campaign-form" class="personalization-form" novalidate>
                <div class="form-section">
                    <h3 class="section-title">Informa√ß√µes da Campanha</h3>
                    <div class="form-group">
                        <label for="campaign-title">T√≠tulo da Campanha</label>
                        <input type="text" id="campaign-title" name="title" placeholder="Ex: O Lamento da Dama de Cinzas" required>
                    </div>
                    <div class="form-group">
                        <label for="campaign-synopsis">Sinopse</label>
                        <textarea id="campaign-synopsis" name="synopsis" placeholder="Descreva a premissa principal, os mist√©rios e o tom da sua campanha."></textarea>
                    </div>
                    <div class="form-group image-upload-group">
                        <label for="campaign-image-input">Imagem de Capa</label>
                        <div class="image-preview-container">
                            <img id="campaign-image-preview" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjM2QzZDRmIj48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNhYWFiYmYiIGZvbnQtc2l6ZT0iMjBweCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPjMwMHgyNTA8L3RleHQ+PC9zdmc+" alt="Pr√©-visualiza√ß√£o da capa">
                            <input type="file" id="campaign-image-input" name="imageFile" accept="image/*" style="display: none;">
                            <button type="button" class="wizard-btn" onclick="document.getElementById('campaign-image-input').click()">Escolher Imagem</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="button" class="wizard-btn" onclick="alert('Funcionalidade em desenvolvimento!')">Adicionar Jogadores</button>
                    </div>
                </div>
            </form>

            <!-- Abas do Mestre -->
            <div class="master-tabs">
                <button class="tab-link active" data-tab="escudo-mestre">Escudo do Mestre</button>
                <button class="tab-link" data-tab="mapa">Mapa</button>
            </div>

            <!-- Conte√∫do das Abas -->
            <div class="tab-content active" id="escudo-mestre">
                <h4>Recursos do Mestre</h4>
                <p>Aqui voc√™ ver√° as fichas dos jogadores, monstros, notifica√ß√µes de altera√ß√µes e o log de dados rolados. (Em desenvolvimento)</p>
                <div class="master-tools-grid">
                    <div class="tool-placeholder">Lista de Jogadores</div>
                    <div class="tool-placeholder">Fichas de Monstros</div>
                    <div class="tool-placeholder">Notifica√ß√µes</div>
                    <div class="tool-placeholder">Log de Dados</div>
                </div>
            </div>

            <div class="tab-content" id="mapa">
                <div class="premium-lock">
                    <span class="lock-icon">üîí</span>
                    <h3>Recurso Premium</h3>
                    <p>A funcionalidade de Mapa Interativo est√° dispon√≠vel apenas para apoiadores. Considere se tornar um Patrono para desbloquear este e outros recursos incr√≠veis!</p>
                    <a href="patente.html" class="wizard-btn">Ver Planos de Apoio</a>
                </div>
                <div class="map-content-unlocked">
                    <h3>Mapa Interativo</h3>
                    <p>Funcionalidade de mapa desbloqueada. (Em desenvolvimento)</p>
                    <div class="tool-placeholder">√Årea do Mapa</div>
                </div>
            </div>

            <!-- Ferramentas de IA -->
            <div class="form-section ai-tools-section">
                <h3 class="section-title">Ferramentas com IA</h3>
                <div class="ai-tools">
                    <button class="wizard-btn" onclick="alert('Funcionalidade em desenvolvimento!')">Gerar NPC com IA</button>
                    <button class="wizard-btn" onclick="alert('Funcionalidade em desenvolvimento!')">Gerar Campanha com IA</button>
                </div>
            </div>

            <div style="text-align:center; margin-top:3rem;">
                <a href="campanhas.html" class="wizard-btn cancel-btn">Cancelar</a>
                <button type="submit" form="create-campaign-form" id="save-campaign-btn" class="wizard-btn">Salvar Campanha</button>
            </div>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Script da p√°gina de cria√ß√£o de campanha
        document.addEventListener('DOMContentLoaded', async () => {
            // Carrega o header antes de adicionar os listeners
            await loadHeader();
            updateActiveLinks();
            checkAuthStatus();

            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            tabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const tabId = link.dataset.tab;

                    tabLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            // L√≥gica para salvar a campanha
            const campaignForm = document.getElementById('create-campaign-form');
            const imageInput = document.getElementById('campaign-image-input');
            const imagePreview = document.getElementById('campaign-image-preview');

            imageInput.addEventListener('change', () => {
                const file = imageInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => { imagePreview.src = e.target.result; };
                    reader.readAsDataURL(file);
                }
            });

            if (campaignForm) {
                campaignForm.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const title = document.getElementById('campaign-title').value.trim();
                    const synopsis = document.getElementById('campaign-synopsis').value.trim();
                    const imageFile = imageInput.files[0];

                    let imageUrl = '';
                    if (imageFile) {
                        imageUrl = await readFileAsDataURL(imageFile);
                    }

                    if (!title) {
                        alert('Por favor, d√™ um t√≠tulo para a sua campanha.');
                        document.getElementById('campaign-title').focus();
                        return;
                    }

                    const newCampaign = {
                        id: `camp_${Date.now()}`,
                        title: title,
                        synopsis: synopsis,
                        imageUrl: imageUrl,
                        createdAt: new Date().toISOString()
                    };
                    saveCampaign(newCampaign);
                });
            }
        });
    </script>
    <script src="script.js"></script>
</body>
</html>