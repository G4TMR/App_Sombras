<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√Årvore de Habilidades - Sombras do Abismo</title>
<style>
    body {
        margin: 0;
        background-color: #0f0f12;
        color: #e0e0e0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Interface de Controle */
    #ui-controls {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 100;
        background: rgba(0,0,0,0.7);
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #333;
    }

    select {
        background: #222;
        color: #fff;
        border: 1px solid #555;
        padding: 8px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
    }

    #tree-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle at center, #1b1b25 0%, #050505 100%);
    }

    #nodes-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
    }

    svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }

    .node {
        position: absolute;
        width: 60px;
        height: 60px;
        background: #2a2a35;
        border: 2px solid #444;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
        box-shadow: 0 0 20px rgba(0,0,0,0.8);
        /* Centraliza o n√≥ baseado na posi√ß√£o top/left */
        transform: translate(-50%, -50%);
    }

    .node:hover {
        transform: translate(-50%, -50%) scale(1.2);
        z-index: 20;
        border-color: #fff;
    }

    /* Tipos de Habilidade (Cores) */
    .node.type-specialization { border-color: #ffd700; box-shadow: 0 0 15px #ffd700, inset 0 0 10px rgba(255, 215, 0, 0.2); }
    .node.type-active { border-color: #ff4444; box-shadow: 0 0 15px #ff4444, inset 0 0 10px rgba(255, 68, 68, 0.2); }
    .node.type-passive { border-color: #44ff44; box-shadow: 0 0 15px #44ff44, inset 0 0 10px rgba(68, 255, 68, 0.2); }
    .node.type-reaction { border-color: #aa44ff; box-shadow: 0 0 15px #aa44ff, inset 0 0 10px rgba(170, 68, 255, 0.2); }

    .node-icon {
        font-size: 24px;
        pointer-events: none;
        user-select: none;
    }

    .tooltip {
        position: absolute;
        background: rgba(10, 10, 12, 0.95);
        border: 1px solid #555;
        padding: 15px;
        border-radius: 6px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 100;
        max-width: 250px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.9);
    }

    .tooltip h4 { margin: 0 0 5px 0; color: #fff; font-size: 1.1em; }
    .tooltip .meta { font-size: 0.8em; color: #888; margin-bottom: 8px; display: block; text-transform: uppercase; letter-spacing: 1px; }
    .tooltip p { margin: 0; font-size: 0.95em; color: #ccc; line-height: 1.4; }

    .path {
        fill: none;
        stroke: #555;
        stroke-width: 2;
        filter: drop-shadow(0 0 2px rgba(255,255,255,0.3));
        transition: stroke 0.3s;
    }
</style>
</head>
<body>

<div id="ui-controls">
    <h3 style="margin: 0 0 10px 0; color: #fff;">√Årvore de Habilidades</h3>
    <label for="class-select">Classe:</label>
    <select id="class-select">
        <option value="belico">B√©lico</option>
        <option value="esoterico">Esot√©rico</option>
        <option value="erudito">Erudito</option>
    </select>
</div>

<div id="tree-container">
    <svg id="connections"></svg>
    <div id="nodes-layer"></div>
    <div id="tooltip" class="tooltip"></div>
</div>

<!-- Importa os dados das √°rvores -->
<script src="skillTrees.js"></script>

<script>
    const nodesLayer = document.getElementById('nodes-layer');
    const svgLayer = document.getElementById('connections');
    const tooltip = document.getElementById('tooltip');
    const classSelect = document.getElementById('class-select');

    // √çcones por tipo
    const icons = {
        specialization: "üåü",
        active: "‚öîÔ∏è",
        passive: "üõ°Ô∏è",
        reaction: "‚ö°"
    };

    function init() {
        if (!window.skillTrees) {
            alert("Erro: O arquivo skillTrees.js n√£o foi carregado. Verifique se ele est√° na mesma pasta.");
            return;
        }
        classSelect.addEventListener('change', () => renderTree(classSelect.value));
        window.addEventListener('resize', () => renderTree(classSelect.value));
        // Renderiza a primeira classe por padr√£o
        renderTree('belico');
    }

    function renderTree(className) {
        nodesLayer.innerHTML = '';
        svgLayer.innerHTML = '';

        const treeData = window.skillTrees[className];
        if (!treeData) return;

        // Combina habilidades e especializa√ß√µes em uma lista √∫nica para renderizar
        const allNodes = [...treeData.skills, ...treeData.specializations];
        
        // Mapa para busca r√°pida por ID (usado para desenhar linhas)
        const nodeMap = {};
        allNodes.forEach(n => nodeMap[n.id] = n);

        // 1. Desenhar Conex√µes (Linhas)
        allNodes.forEach(node => {
            if (node.requirements && node.requirements.skills) {
                node.requirements.skills.forEach(parentId => {
                    const parent = nodeMap[parentId];
                    if (parent) {
                        drawConnection(parent, node);
                    }
                });
            }
        });

        // 2. Desenhar N√≥s
        allNodes.forEach(node => createNodeElement(node));
    }

    function getScreenCoords(node) {
        // Converte porcentagem (0-100) para pixels da tela
        const x = (node.position.x / 100) * window.innerWidth;
        const y = (node.position.y / 100) * window.innerHeight;
        return { x, y };
    }

    function drawConnection(parent, child) {
        const pCoords = getScreenCoords(parent);
        const cCoords = getScreenCoords(child);

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        
        // Curva de B√©zier
        const cp1x = pCoords.x;
        const cp1y = (pCoords.y + cCoords.y) / 2;
        const cp2x = cCoords.x;
        const cp2y = (pCoords.y + cCoords.y) / 2;

        const d = `M ${pCoords.x} ${pCoords.y} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${cCoords.x} ${cCoords.y}`;
        
        path.setAttribute("d", d);
        path.setAttribute("class", "path");
        svgLayer.appendChild(path);
    }

    function createNodeElement(skill) {
        const el = document.createElement('div');
        el.className = `node type-${skill.type}`;
        el.style.left = `${skill.position.x}%`;
        el.style.top = `${skill.position.y}%`;
        
        const icon = icons[skill.type] || "üîπ";
        el.innerHTML = `<span class="node-icon">${icon}</span>`;

        el.addEventListener('mouseenter', (e) => {
            tooltip.style.opacity = 1;
            tooltip.innerHTML = `<h4>${skill.name}</h4><span class="meta">${skill.type} | Custo: ${skill.cost}</span><p>${skill.description}</p>`;
            tooltip.style.left = (e.pageX + 20) + 'px';
            tooltip.style.top = (e.pageY + 20) + 'px';
        });
        el.addEventListener('mouseleave', () => tooltip.style.opacity = 0);

        nodesLayer.appendChild(el);
    }

    window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>